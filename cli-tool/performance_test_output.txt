(node:38744) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 warning listeners added to [process]. Use emitter.setMaxListeners() to increase limit
(Use `node --trace-warnings ...` to show where the warning was created)
(node:38744) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 uncaughtException listeners added to [process]. Use emitter.setMaxListeners() to increase limit
(node:38744) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 unhandledRejection listeners added to [process]. Use emitter.setMaxListeners() to increase limit
FAIL tests/unit/PerformanceMonitor.test.js
  PerformanceMonitor
    constructor
      ✓ should initialize with default options (2 ms)
      ✓ should merge custom options (1 ms)
    timer operations
      ✓ should start and end timers correctly (1 ms)
      ✓ should handle ending non-existent timer
      ✓ should record timer metadata
    counter operations
      ✓ should increment counters (1 ms)
      ✓ should handle initial counter value
    metric recording
      ✓ should record metrics in categories (1 ms)
      ✓ should add timestamp if not provided
      ✓ should limit metric array size (3 ms)
      ✓ should skip recording when disabled
    error recording
      ✓ should record errors
    request recording
      ✓ should record successful requests
      ✓ should record error requests (1 ms)
    cache recording
      ✓ should record cache operations
    WebSocket recording
      ✓ should record WebSocket events
    system metrics collection
      ✓ should collect memory and CPU metrics
    statistics calculation
      ✓ should calculate request statistics (1 ms)
      ✓ should calculate cache hit rate (1 ms)
      ✓ should include error count
      ✓ should include memory statistics (1 ms)
      ✓ should filter by timeframe
    Express middleware
      ✓ should create Express middleware function (1 ms)
      ✕ should track request performance (11 ms)
    cleanup and memory management
      ✓ should clean up old metrics

  ● PerformanceMonitor › Express middleware › should track request performance

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

      62 |         const duration = performanceMonitor.endTimer(timerName);
      63 |         
    > 64 |         expect(duration).toBeGreaterThan(0);
         |                          ^
      65 |         expect(performanceMonitor.timers[timerName]).toBeUndefined();
      66 |         expect(performanceMonitor.metrics.performance).toBeDefined();
      67 |       }, 10);

      at Timeout._onTimeout (tests/unit/PerformanceMonitor.test.js:64:26)

--------------------------|---------|----------|---------|---------|----------------------------
File                      | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s          
--------------------------|---------|----------|---------|---------|----------------------------
All files                 |    2.24 |     1.68 |    3.79 |    2.21 |                            
 analytics-web/components |       0 |        0 |       0 |       0 |                            
  ActivityHeatmap.js      |       0 |        0 |       0 |       0 | 7-782                      
  AgentAnalytics.js       |       0 |        0 |       0 |       0 | 7-709                      
  App.js                  |       0 |        0 |       0 |       0 | 7-440                      
  Charts.js               |       0 |        0 |       0 |       0 | 7-113                      
  ConversationTable.js    |       0 |        0 |       0 |       0 | 7-436                      
  DashboardPage.js        |       0 |        0 |       0 |       0 | 7-2289                     
  HeaderComponent.js      |       0 |        0 |       0 |       0 | 7-306                      
  SessionTimer.js         |       0 |        0 |       0 |       0 | 7-598                      
  Sidebar.js              |       0 |        0 |       0 |       0 | 7-187                      
  ToolDisplay.js          |       0 |        0 |       0 |       0 | 7-553                      
 analytics-web/services   |       0 |        0 |       0 |       0 |                            
  DataService.js          |       0 |        0 |       0 |       0 | 7-449                      
  StateService.js         |       0 |        0 |       0 |       0 | 7-284                      
  WebSocketService.js     |       0 |        0 |       0 |       0 | 7-534                      
 analytics/core           |       0 |        0 |       0 |       0 |                            
  AgentAnalyzer.js        |       0 |        0 |       0 |       0 | 5-355                      
  ConversationAnalyzer.js |       0 |        0 |       0 |       0 | 1-949                      
  FileWatcher.js          |       0 |        0 |       0 |       0 | 1-420                      
  ProcessDetector.js      |       0 |        0 |       0 |       0 | 1-280                      
  SessionAnalyzer.js      |       0 |        0 |       0 |       0 | 5-686                      
  StateCalculator.js      |       0 |        0 |       0 |       0 | 1-246                      
  YearInReview2025.js     |       0 |        0 |       0 |       0 | 1-983                      
 analytics/data           |       0 |        0 |       0 |       0 |                            
  DataCache.js            |       0 |        0 |       0 |       0 | 1-685                      
 analytics/notifications  |       0 |        0 |       0 |       0 |                            
  NotificationManager.js  |       0 |        0 |       0 |       0 | 5-485                      
  WebSocketServer.js      |       0 |        0 |       0 |       0 | 5-526                      
 analytics/utils          |    78.9 |    65.71 |   85.36 |   79.66 |                            
  PerformanceMonitor.js   |    78.9 |    65.71 |   85.36 |   79.66 | 46-48,73,81,88,253,388-425 
--------------------------|---------|----------|---------|---------|----------------------------
Jest: "global" coverage threshold for statements (70%) not met: 3.24%
Jest: "global" coverage threshold for branches (70%) not met: 2.49%
Jest: "global" coverage threshold for lines (70%) not met: 3.18%
Jest: "global" coverage threshold for functions (70%) not met: 5.56%
Jest: "./src/analytics/core/" coverage threshold for statements (80%) not met: 0%
Jest: "./src/analytics/core/" coverage threshold for branches (80%) not met: 0%
Jest: "./src/analytics/core/" coverage threshold for lines (80%) not met: 0%
Jest: "./src/analytics/core/" coverage threshold for functions (80%) not met: 0%
Test Suites: 1 failed, 1 total
Tests:       1 failed, 24 passed, 25 total
Snapshots:   0 total
Time:        2.732 s
Ran all test suites matching tests/unit/PerformanceMonitor.test.js.
Jest did not exit one second after the test run has completed.

'This usually means that there are asynchronous operations that weren't stopped in your tests. Consider running Jest with `--detectOpenHandles` to troubleshoot this issue.
(node:38744) [JEST-01] DeprecationWarning: 'log' property was accessed on [Object] after it was soft deleted
  Jest deletes objects that were set on the global scope between test files to reduce memory leaks.
  Currently it only "soft" deletes them and emits this warning if those objects were accessed after their deletion.
  In future versions of Jest, this behavior will change to "on", which will likely fail tests.
  You can change the behavior in your test configuration now to reduce memory usage.
